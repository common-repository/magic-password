!function(a,o,n){try{var s=a('input[name="mf-only"]'),e=a('input[name="mf-logging"]'),t=a(".mf-status-bar"),l=a(".mf-js-disable-option-no"),i=a("#mf-only-no"),m=a(".mf-review-notice"),f=a(".mf-js-save-roles"),d=a(".mf-js-roles-form"),r=a(".mf-js-bottom-options"),c=a(".mf-js-form-logging"),u={initialized:!1,penultimate:null,current:null,update:function(s){this.penultimate=this.current,this.current=s},undo:function(){this.current=this.penultimate,this.penultimate=null}};function b(s){return mpwdDashboardParams.baseConfigurationUrl+s}function p(s){return mpwdDashboardParams.baseSettingsUrl+s}function w(s){var e=JSON.parse(s.responseText).error;Sentry.captureMessage("Dashboard error",{extra:{error:e,status:s.status}}),n.showErrorModal(e)}function v(s){var e=a('input[name="'+s+'"][value="no"]'),n=a('input[name="'+s+'"][value="yes"]'),o=e.prop("checked");e.prop("checked",n.prop("checked")),n.prop("checked",o)}function h(s){a('.mf-js-roles-form input:checkbox[name="role"]').each(function(){a(this).attr("checked",!1)}),s.forEach(function(s){a('.mf-js-roles-form input:checkbox[value="'+s+'"]').attr("checked",!0)})}function g(){return a('.mf-js-roles-form input:checkbox[name="role"]:checked').map(function(){return this.value}).get()}function C(s){a("."+s).addClass("mf-hidden")}function j(s){a("."+s).removeClass("mf-hidden")}d.length&&!u.initialized&&(u.current=g(),u.initialized=!0),l.click(function(){i.attr("disabled",!0),i.addClass("mf-option-disabled"),a(".mf-only-yes-label").removeClass("mf-js-disable-option-no")}),e.on("change",function(){var e=a('input[name="mf-logging"]:checked').val();c.addClass("mf-wait"),a.post(p("save-logging"),{_wpnonce:a(".mf-js-form-logging #_wpnonce").val(),"mf-logging":e}).done(function(s){o.showToast(s.message),c.removeClass("mf-wait"),mpwdSentry.loggingAllowed="yes"==e}).fail(function(s){w(s),v("mf-logging"),c.removeClass("mf-wait")})}),a(document).on("click",".mf-js-enable-passwordless-login",function(s){s.preventDefault();var e="mf-enabled",n="mf-js-disable-passwordless-login";a(".mf-status-bar-container").hasClass("has_passwordless_role")&&(e="mf-blocked",n="mf-switch-btn-blocked"),t.removeClass("mf-disabled").addClass(e+" mf-wait"),a(".mf-switch-btn").removeClass("mf-switch-btn-disabled mf-js-enable-passwordless-login").addClass(n),j("mf-js-bottom-options"),a.post(b("enable-passwordless-login"),{_wpnonce:a(".mf-js-csrf-token-for-enable-action").val()}).done(function(s){t.removeClass("mf-wait"),o.showToast(s.message)}).fail(function(s){t.removeClass("mf-wait "+e).addClass("mf-disabled"),a(".mf-switch-btn").removeClass(n).addClass("mf-switch-btn-disabled mf-js-enable-passwordless-login"),C("mf-js-bottom-options"),w(s)})}),a(document).on("click",".mf-js-disable-passwordless-login",function(s){s.preventDefault(),t.removeClass("mf-enabled").addClass("mf-disabled mf-wait"),a(".mf-switch-btn").removeClass("mf-js-disable-passwordless-login").addClass("mf-switch-btn-disabled mf-js-enable-passwordless-login"),C("mf-js-bottom-options"),a.post(b("disable-passwordless-login"),{_wpnonce:a(".mf-js-csrf-token-for-disable-action").val()}).done(function(s){t.removeClass("mf-wait"),o.showToast(s.message)}).fail(function(s){t.removeClass("mf-wait mf-disabled").addClass("mf-enabled"),a(".mf-switch-btn").removeClass("mf-switch-btn-disabled mf-js-enable-passwordless-login").addClass("mf-js-disable-passwordless-login"),j("mf-js-bottom-options"),w(s)})}),m.on("click",".notice-dismiss",function(){a.post(p("close-review-notice"),{_wpnonce:a(".mf-review-notice input").val()}).fail(function(s){w(s)})}),s.on("change",function(){var s=a('input[name="mf-only"]:checked').val();r.addClass("mf-wait"),a.post(b("set-obligatoriness"),{_wpnonce:a(".mf-option #_wpnonce").val(),"mf-only":s}).done(function(s){o.showToast(s.message),r.removeClass("mf-wait")}).fail(function(s){w(s),v("mf-only"),r.removeClass("mf-wait")})}),f.on("click",function(s){s.preventDefault(),f.addClass("mf-btn-disabled"),a(".mf-js-roles-form").addClass("mf-wait");var e=g();a.post(p("save-roles"),{_wpnonce:a(".mf-js-roles-form #_wpnonce").val(),roles:e}).done(function(s){o.showToastWithUndoOption(s.message),f.removeClass("mf-btn-disabled"),a(".mf-js-roles-form").removeClass("mf-wait"),u.update(e)}).fail(function(s){w(s),h(u.current),f.removeClass("mf-btn-disabled"),a(".mf-js-roles-form").removeClass("mf-wait")})}),a(".mf-undo").on("click",function(s){s.preventDefault(),o.closeToast(),a.post(p("save-roles"),{_wpnonce:a(".mf-js-roles-form #_wpnonce").val(),roles:u.penultimate}).done(function(){o.showToast("Changes have been undone."),h(u.penultimate),u.undo()}).fail(function(s){w(s)})}),a(document).on("click",".mf-js-enable-plugin",function(s){s.preventDefault(),t.removeClass("mf-disabled").addClass("mf-enabled mf-wait"),a(".mf-switch-btn").removeClass("mf-switch-btn-disabled mf-js-enable-plugin").addClass("mf-js-disable-plugin"),j("mf-js-role-container"),j("mf-js-bottom-options"),a.post(p("enable-plugin"),{_wpnonce:a(".mf-js-csrf-enable").val()}).done(function(s){t.removeClass("mf-wait"),o.showToast(s.message)}).fail(function(s){t.removeClass("mf-enabled mf-wait").addClass("mf-disabled"),a(".mf-switch-btn").removeClass("mf-js-disable-plugin").addClass("mf-switch-btn-disabled mf-js-enable-plugin"),C("mf-js-role-container"),C("mf-js-bottom-options"),w(s)})}),a(document).on("click",".mf-js-disable-plugin",function(s){s.preventDefault(),t.removeClass("mf-enabled").addClass("mf-disabled mf-wait"),a(".mf-switch-btn").removeClass("mf-js-disable-plugin").addClass("mf-switch-btn-disabled mf-js-enable-plugin"),C("mf-js-role-container"),C("mf-js-bottom-options"),a.post(p("disable-plugin"),{_wpnonce:a(".mf-js-csrf-disable").val()}).done(function(s){t.removeClass("mf-wait"),o.showToast(s.message)}).fail(function(s){t.removeClass("mf-disabled mf-wait").addClass("mf-enabled"),a(".mf-switch-btn").removeClass("mf-switch-btn-disabled mf-js-enable-plugin").addClass("mf-js-disable-plugin"),j("mf-js-role-container"),j("mf-js-bottom-options"),w(s)})})}catch(s){Sentry.captureException(s),n.showErrorModal(s.message)}}(jQuery,mpwdDashboard.toaster,mpwdDashboard.modal);